<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
	    <link href="https://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="style.css">
		<title>IDE Project 2</title>
		<script type="text/javascript" src="d3/d3.js"></script>
	</head>
	<body>
		<h1>Project 2 in IDE</h1>
		<h1><small>How has the weather changed over the past 100 years?</small></h1>
	  	<div>
	  		<table class="names">
		  		<tr>
		  			<td>Eduards Klavins</td>
		  			<td>Ehsan Khaveh</td>
		  			<td>Olugbenga Oti</td>
		  		</tr>
	  		</table>
	  	</div>

	    <div class="container">
        <div class="jumbotron">
		 	<h2>Temperature changes during last 100 years in Copenhagen</h2>
 			<svg id="visualisation1" width="1000" height="500"></svg>
        </div>
		<h3>Motivation, method, results/discussion, and conclusions for the first visualization</h3>
 		<p>
 			Got the dataset from <a href="http://data.giss.nasa.gov/tmp/gistemp/STATIONS/tmp_612061860000_14_0/station.txt"> here. </a> Then remade it to CSV. Later realized that it's a TSV and should not have done extra work.
 		</p>
        <div class="jumbotron">
		 	<h2>Placeholder for second visualization</h2>
 			<svg id="visualisation2" width="1000" height="500"></svg>
        </div>
		<h3>Motivation, method, results/discussion, and conclusions for the second visualization</h3>
 		<p>
 		Type stuff here.
 		</p>
 		<h3><strong>Individual part</strong></h3>
	  	<div class="ind_div">
	  		<h4>Eduards Klavins</h4>
	  		<p>
	  		Type here.
	  		</p>
	  	</div>
	  	<div class="ind_div">
	  		<h4>Ehsan Khaveh</h4>
	  		<p>
	  		Type here.
	  		</p>
	  	</div>
	  	<div class="ind_div">
	  		<h4>Olugbenga Oti</h4>
	  		<p>
	  		Type here.
	  		</p>
	  	</div>
    </div>

	</body>
	<script type="text/javascript">

		// Read in the data from the file called "dataset.csv"
		d3.csv("dataset.csv", function(error,dataset) {

			if (error){

				console.log(error);
			} else {
				// initialize data storage
				var data = [];
				// initialize axis ranges
				var xmin = 0;
				var xmax = 0;
				var ymin = 0;
				var ymax = 0;

				//assign values from CSV by looping over 
				for (var i = 0; i < dataset.length; i++) {

					var instance = {};
					instance["year"] = parseInt(dataset[i]["YEAR"]);
					instance["temperature"] = parseFloat(dataset[i]["metANN"]);
					data.push(instance);

					// initialize axis ranges
					if (i === 0) {
						var xmin = instance["year"];
						var xmax = instance["year"];
						var ymin = instance["temperature"];
						var ymax = instance["temperature"];
					};

					if (instance["year"] > xmax) {
						xmax = instance["year"];
					};
					if(instance["year"] < xmin) {
						xmin = instance["year"];
					};
					if(instance["temperature"]>ymax){
						ymax = instance["temperature"];
					};
					if(instance["temperature"] < ymin){
						ymin = instance["temperature"];
					};
				};

				// Print out in the console the object
				console.log(data);

				// Plotting begins
				// Tutorial: https://code.tutsplus.com/tutorials/building-a-multi-line-chart-using-d3js--cms-22935

				//Firstly, we select the predefined SVG element and set its width, height and margins
				var vis = d3.select("#visualisation1"),
			    WIDTH = 1000,
			    HEIGHT = 500,
			    MARGINS = {
			        top: 20,
			        right: 20,
			        bottom: 20,
			        left: 50
			    },
			    // here we define the ranges and domains of x and y scales
			    xScale = d3.scaleLinear().range([MARGINS.left, WIDTH - MARGINS.right]).domain([xmin,xmax]),
			    yScale = d3.scaleLinear().range([HEIGHT - MARGINS.top, MARGINS.bottom]).domain([ymin,ymax]),
			    // define the axis
			    xAxis = d3.axisBottom()
				    .scale(xScale),
				  
				yAxis = d3.axisLeft()
				    .scale(yScale);

				// Append both axis
				vis.append("svg:g")
				    .attr("transform", "translate(0," + (HEIGHT - MARGINS.bottom) + ")")
				    .call(xAxis);

				vis.append("svg:g")
				    .attr("transform", "translate(" + (MARGINS.left) + ",0)")
				    .call(yAxis);

				// Append axis labels
				vis.append("text")
				    .attr("class", "x label")
				    .attr("text-anchor", "end")
				    .attr("x", WIDTH-20)
				    .attr("y", HEIGHT-25)
				    .text("Year");

				vis.append("text")
				    .attr("class", "y label")
				    .attr("text-anchor", "end")
				    .attr("y", 65)
				    .attr("x", -20)
				    .attr("transform", "rotate(-90)")
				    .text("Temperature °C");

				// generate the actual line
				var lineGen = d3.line()
				  .x(function(d) {
				    return xScale(d.year);
				  })
				  .y(function(d) {
				    return yScale(d.temperature);
				  });

				// Add the line to SVG
				vis.append('svg:path')
				  .attr('d', lineGen(data))
				  .attr('stroke', 'green')
				  .attr('stroke-width', 2)
				  .attr('fill', 'none');

				// ==========================================================
				// Added on mouseover event
				// Credit: https://bl.ocks.org/mbostock/3902569
				var focus = vis.append("g")
				  .attr("class", "focus")
				  .style("display", "none");

				focus.append("circle")
				  .attr("r", 4.5);

				focus.append("text")
				  .attr("x", 9)
				  .attr("dy", ".35em");

				vis.append("rect")
				  .attr("class", "overlay")
				  .attr("width", WIDTH)
				  .attr("height", HEIGHT)
				  .on("mouseover", function() { focus.style("display", null); })
				  .on("mouseout", function() { focus.style("display", "none"); })
				  .on("mousemove", mousemove);

				var bisectDate = d3.bisector(function(d) { return d.year; }).left;
				
				function mousemove() {
				var x0 = xScale.invert(d3.mouse(this)[0]),
				    i = bisectDate(data, x0, 1),
				    d0 = data[i - 1],
				    d1 = data[i],
				    d = x0 - d0.year > d1.year - x0 ? d1 : d0;
				focus.attr("transform", "translate(" + xScale(d.year) + "," + yScale(d.temperature) + ")");
				console.log("D0 temp: "+ d0.temperature+" ; year: "+ d0.year);
				console.log("D1 temp: "+ d1.temperature+" ; year: "+ d1.year);
				console.log("I: " + i);
				focus.select("text").text(d.temperature+" °C at " + d.year);
				};
				// ==========================================================
			}
		});

	</script>
</html>